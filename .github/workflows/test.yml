on:
  push: 
    branches: 
      - branch-1

  workflow_dispatch:

env:
  FILE_SIZE_TO_SEARCH: 15000 #in Bytes 

name: Get files with larger size    
jobs:
  get-large-files:
    runs-on: ubuntu-latest
    steps:    
    - uses: actions/github-script@v5
      id: get-file-list
      name: Search for the file
      env:
        MAX_FILE_SIZE: ${{ env.FILE_SIZE_TO_SEARCH }}
      with:
        script: |
          const org = 'actions'
          const {MAX_FILE_SIZE} = process.env
          const q = `size:>${MAX_FILE_SIZE}+org:${org}`

          const searchResult = await github.rest.search.code({
            q,
          });

          let fileList = `File,Path,Repository,URL\n`
          
          for (const item of searchResult.data.items) {
            fileName = `${item.name}`
            filePath = `${item.path}`
            repository = `${item.repository.full_name}`,
            url = `${item.url}`
            
            fileList += `${fileName},${filePath},${repository},${url}\n`
            
          }
         
          core.info(`$fileList`)
          //core.setOutput('fileList', String(${fileList}) )
          
    - name: Save File          
      run: |
        echo "${{ steps.get-file-list.outputs.fileList }}" >> large_file_list.csv
    - uses: actions/upload-artifact@v3
      with:
        name: large_file_list
        path: large_file_list.csv
